{% extends "base.html" %}
{% load crispy_forms_tags %}

{% block title %}Chat{% endblock title %}

{% block content %}
<div class="container py-5 chat-container">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1>Chat with Your AI Motivator</h1>
        <a href="{% url 'clear_chat' %}" class="btn btn-danger" onclick="return confirm('Are you sure you want to clear the chat history?');">Clear Chat</a>
    </div>

    <div class="chat-box border rounded p-3 mb-4" id="chatMessages">
        {% for message in messages %}
            <div class="message {% if message.is_user %}user-message{% else %}ai-message{% endif %}">
                {% if message.is_user %}
                    {{ message.text }}
                {% else %}
                    {{ message.text|safe }}  <!-- Use 'safe' filter for AI messages -->
                {% endif %}
            </div>
        {% endfor %}
    </div>
    

    <form method="post" class="chat-form">
        {% csrf_token %}
        {{ form|crispy }}
        <button type="submit" class="btn btn-primary w-100">Send</button>
    </form>



<script>
    // Auto-scroll to latest message
    var chatMessages = document.getElementById("chatMessages");
    chatMessages.scrollTop = chatMessages.scrollHeight;
</script>
{% endblock content %}
